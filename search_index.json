[["ggsc.html", "Visualizing single cell data Preface 1 Visualizing Seurat objects 1.1 Dimensional reduction plot 1.2 Visualize ‘features’ on a dimensional reduction plot 1.3 Visualize ellipse on a dimensional reduction plot 1.4 Visualize selected clusters 1.5 Dot plot 1.6 Violin plot of gene expression 1.7 Spatial features", " Visualizing single cell data Guangchuang Yu and Shuangbin Xu Department of Bioinformatics, School of Basic Medical Sciences, Southern Medical University guangchuangyu@gmail.com 2023-11-01 Preface hello world 1 Visualizing Seurat objects knitr::opts_chunk$set(tidy = FALSE, warning = FALSE, message = FALSE, eval=TRUE, echo=TRUE, cache=TRUE, fig.width = 9, fig.height = 6, out.width=&quot;100%&quot; ) library(Seurat) dir = &quot;data/filtered_gene_bc_matrices/hg19&quot; pbmc.data &lt;- Read10X(data.dir = dir) pbmc &lt;- CreateSeuratObject(counts = pbmc.data, project = &quot;pbmc3k&quot;, min.cells=3, min.features=200) pbmc ## An object of class Seurat ## 13714 features across 2700 samples within 1 assay ## Active assay: RNA (13714 features, 0 variable features) pbmc[[&quot;percent.mt&quot;]] &lt;- PercentageFeatureSet(pbmc, pattern = &quot;^MT-&quot;) pbmc &lt;- subset(pbmc, subset = nFeature_RNA &gt; 200 &amp; nFeature_RNA &lt; 2500 &amp; percent.mt &lt; 5 ) pbmc &lt;- NormalizeData(pbmc, normalization.method = &quot;LogNormalize&quot;, scale.factor = 10000) pbmc &lt;- ScaleData(pbmc) pbmc &lt;- FindVariableFeatures(pbmc, selection.method = &quot;vst&quot;, nfeatures = 2000) pbmc &lt;- RunPCA(pbmc, features = VariableFeatures(object = pbmc)) pbmc &lt;- RunUMAP(pbmc, dims = 1:10) pbmc &lt;- FindNeighbors(pbmc, dims = 1:10) pbmc &lt;- FindClusters(pbmc, resolution = 0.5) ## Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck ## ## Number of nodes: 2638 ## Number of edges: 95927 ## ## Running Louvain algorithm... ## Maximum modularity in 10 random starts: 0.8728 ## Number of communities: 9 ## Elapsed time: 0 seconds ## Assigning cell type identity to clusters cluster.ids &lt;- c(&quot;Naive CD4 T&quot;, &quot;CD14+ Mono&quot;, &quot;Memory CD4 T&quot;, &quot;B&quot;, &quot;CD8 T&quot;, &quot;FCGR3A+ Mono&quot;, &quot;NK&quot;, &quot;DC&quot;, &quot;Platelet&quot;) names(cluster.ids) &lt;- levels(pbmc) pbmc &lt;- RenameIdents(pbmc, cluster.ids) 1.1 Dimensional reduction plot # DimPlot(pbmc, reduction = &quot;umap&quot;, # label = TRUE, pt.size = 0.5) library(ggplot2) library(ggsc) sc_dim(pbmc) + sc_dim_geom_label() sc_dim(pbmc) + sc_dim_geom_label(geom = shadowtext::geom_shadowtext, color=&#39;black&#39;, bg.color=&#39;white&#39;) 1.2 Visualize ‘features’ on a dimensional reduction plot features = c(&quot;MS4A1&quot;, &quot;GNLY&quot;, &quot;CD3E&quot;, &quot;CD14&quot;, &quot;FCER1A&quot;, &quot;FCGR3A&quot;, &quot;LYZ&quot;, &quot;PPBP&quot;, &quot;CD8A&quot;) # FeaturePlot(pbmc,&#39;CD4&#39;) sc_feature(pbmc, &#39;CD4&#39;) # FeaturePlot(pbmc, features) sc_feature(pbmc, features) Here is the real ‘features’ on dimensional plot sc_dim(pbmc) + sc_dim_geom_feature(pbmc, &#39;CD4&#39;, color=&#39;black&#39;) sc_dim(pbmc, alpha=.3) + ggnewscale::new_scale_color() + sc_dim_geom_feature(pbmc, features, mapping=aes(color=features)) + scale_color_viridis_d() sc_dim(pbmc) + sc_dim_geom_feature(pbmc, &#39;CD4&#39;, color=&#39;black&#39;) sc_dim(pbmc, alpha=.3) + ggnewscale::new_scale_color() + sc_dim_geom_feature(pbmc, features, mapping=aes(color=features)) + scale_color_viridis_d() 1.3 Visualize ellipse on a dimensional reduction plot sc_dim(pbmc) + sc_dim_geom_ellipse(level=0.95) 1.4 Visualize selected clusters selected &lt;- c(&quot;Naive CD4 T&quot;, &quot;NK&quot;) sc_dim(pbmc) + sc_dim_sub(subset=selected) sc_dim(pbmc, color=&#39;grey&#39;) + sc_dim_geom_sub(subset=selected) + sc_dim_geom_label(geom = shadowtext::geom_shadowtext, mapping = aes(subset = ident %in% selected), color=&#39;black&#39;, bg.color=&#39;white&#39;) 1.5 Dot plot DotPlot(pbmc, features = c(&quot;MS4A1&quot;, &quot;GNLY&quot;, &quot;CD3E&quot;, &quot;CD14&quot;, &quot;FCER1A&quot;, &quot;FCGR3A&quot;, &quot;LYZ&quot;, &quot;PPBP&quot;, &quot;CD8A&quot;), group.by = &#39;seurat_clusters&#39;) 1.6 Violin plot of gene expression VlnPlot(pbmc,&#39;CD4&#39;) sc_violin(pbmc, &#39;CD4&#39;) ## allows applying an user-defined function to transform/filter the data sc_violin(pbmc, &#39;CD4&#39;, .fun=function(d) dplyr::filter(d, value &gt; 0)) + ggforce::geom_sina(size=.1) VlnPlot(pbmc, features) sc_violin(pbmc, features) + theme(axis.text.x = element_text(angle=45, hjust=1)) 1.7 Spatial features library(SeuratData) # InstallData(&quot;stxBrain&quot;) brain &lt;- LoadData(&quot;stxBrain&quot;, type = &quot;anterior1&quot;) # Normalization brain &lt;- SCTransform(brain, assay = &quot;Spatial&quot;, verbose = FALSE) SpatialFeaturePlot(brain, features = c(&quot;Hpca&quot;, &quot;Ttr&quot;)) sc_spatial(brain, features = c(&quot;Hpca&quot;, &quot;Ttr&quot;)) "]]
